<!-- ICI TON COVER.HTML CORRIGÃ‰ -->

...

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

const supabase = createClient(
  'https://qgmxclxahaqnvvxhgcms.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFnbXhjbHhhaGFxbnZ2eGhnY21zIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM3OTYxODYsImV4cCI6MjA1OTM3MjE4Nn0.PhMpyFo9ZRgtLHdRyo6MXNjFNFy5WkH8LeqWnPJJCIE'
);

const params = new URLSearchParams(window.location.search);
const interviewId = params.get('id');
const photoArea = document.getElementById('photo-area');
const uploadInput = document.getElementById('upload');
let cropper;

function triggerUpload() {
  uploadInput.click();
}

function finalizeCrop() {
  if (cropper) {
    const canvas = cropper.getCroppedCanvas({ width: 1568, height: 960, fillColor: null });
    const imgUrl = canvas.toDataURL('image/png');
    cropper.destroy();
    cropper = null;
    photoArea.innerHTML = `<img src="${imgUrl}">`;
  }
}

uploadInput.addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();

  reader.onload = function (event) {
    photoArea.innerHTML = `<img id="uploaded-image" src="${event.target.result}">`;
    const image = document.getElementById('uploaded-image');
    if (cropper) cropper.destroy();
    cropper = new Cropper(image, {
      aspectRatio: 3 / 2,
      viewMode: 1,
      autoCropArea: 1,
      background: false,
      responsive: true,
      guides: false,
      movable: true,
      zoomable: true,
      scalable: false,
      cropBoxResizable: true,
      dragMode: 'move'
    });
  }

  reader.readAsDataURL(file);
});

document.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' && cropper) {
    finalizeCrop();
  }
});

async function finalizeCover() {
  const canvas = document.createElement('canvas');
  canvas.width = 1748;
  canvas.height = 2480;
  const ctx = canvas.getContext('2d');

  const background = new Image();
  background.src = 'https://raw.githubusercontent.com/Manupri974/lifebook-V2.1/refs/heads/main/assets/ChatGPT%20Image%2018%20avr.%202025%2C%2000_03_26.png';

  background.onload = async () => {
    ctx.drawImage(background, 0, 0, canvas.width, canvas.height);

    const photo = photoArea.querySelector('img');
    if (photo) {
      ctx.drawImage(photo, 174, 744, 1400, 992);
    }

    ctx.font = 'bold 100px Georgia';
    ctx.fillStyle = '#333';
    ctx.textAlign = 'center';
    ctx.fillText(document.getElementById('title').innerText, canvas.width/2, 250);

    ctx.font = 'italic 70px Georgia';
    ctx.fillText(document.getElementById('subtitle').innerText, canvas.width/2, 400);

    ctx.font = 'italic 80px Georgia';
    ctx.fillText(document.getElementById('author').innerText, canvas.width/2, 2200);

    ctx.font = 'bold 40px Arial';
    ctx.fillStyle = 'white';
    ctx.fillText('LifeBook', canvas.width - 150, canvas.height - 50);

    const coverBase64 = canvas.toDataURL('image/png');

    const { error } = await supabase
      .from('covers')
      .upsert([{ id: interviewId, cover_base64: coverBase64 }]);

    if (error)
